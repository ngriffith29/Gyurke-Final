!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- we import arjs version without NFT but with marker + location based support -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
   

<script>

var renderer = new THREE.WebGLRenderer({
  logarithmicDepthBuffer: true
});

console.log('hi')

    AFRAME.registerComponent('soundhandler', {
        init: function () {
            this.soundEl = document.querySelector('[sound]');
            this.marker = document.querySelector('a-marker');
            this.visible = false;
        },
        tick: function () {
            var isUnlocked = false;
function unlock() {
			
	if(isIOS || this.unlocked)
		return;

	// create empty buffer and play it
	var buffer = myContext.createBuffer(1, 1, 22050);
	var source = myContext.createBufferSource();
	source.buffer = buffer;
	source.connect(myContext.destination);
	source.noteOn(0);

	// by checking the play state after some time, we know if we're really unlocked
	setTimeout(function() {
		if((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {
			isUnlocked = true;
		}
	}, 0);

}

            if (this.marker.object3D.visible && !this.visible) {
                console.log("ding")
                this.soundEl.components.sound.stopSound(); // stop if playing
                this.soundEl.components.sound.playSound(); // play
                this.visible = true; // make sure it plays only once per visible
            } else if (!this.marker.object3D.visible) {
                this.visible = false;
            }
        }
    });
</script>
</head>

    <body style="margin : 0px; overflow: hidden;">
        <a-scene embedded arjs  renderer="logarithmicDepthBuffer: true">

            <a-assets>
                <audio id="sound" src="/assets/audio/better.mp3" preload="auto"></audio>
            </a-assets>
           
        <a-marker preset="hiro" smooth="true">
            <!-- we use cors proxy to avoid cross-origin problems ATTENTION! you need to set up your server -->
            <a-entity
            position="0 4.200 0 "
            scale=".5 .5 .5"
            gltf-model="./assets/Lupez.gltf"
            rotation="-80 0 0"
            ></a-entity>
        </a-marker>
        <a-entity sound="src: #sound" autoplay="false"></a-entity>
        <a-entity camera></a-entity>
        </a-scene>



    </body>
</html>